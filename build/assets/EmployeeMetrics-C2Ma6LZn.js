import{a as Y,r as d,ad as R,j as a}from"./index-CK2Vs4T7.js";import{C as O,a as $}from"./card-C9QVMAe5.js";import{I as E}from"./iconify-tsyH9H0w.js";function B({isFull:v=!1}){const g=Y(e=>e.employee),[y,b]=d.useState([]),[c,f]=d.useState(""),[l,j]=d.useState(null),[h,w]=d.useState([]),[A,k]=d.useState([]),[L,N]=d.useState([]),[S]=R(),q=[{id:"1",title:"Allotted Leaves",subtitle:"Leaves allotted to you",icon:"solar:calendar-linear",color:"bg-primary/10 text-primary",value:(l==null?void 0:l.allottedLeaves)??0},{id:"2",title:"Available Leaves",subtitle:"Your available leaves",icon:"tdesign:undertake-delivery",color:"bg-success/10 text-success",value:(l==null?void 0:l.availableLeaves)??0},{id:"3",title:"Consumed Leaves",subtitle:"Your all taken leaves",icon:"ri:progress-3-line",color:"bg-warning/10 text-warning",value:(l==null?void 0:l.consumedLeaves)??0},{id:"4",title:"Overtime",subtitle:"Additional working days",icon:"lsicon:overtime-filled",color:"bg-error/10 text-error",value:(l==null?void 0:l.overtime)??0}];function C(e){return!Array.isArray(e)||e.length===0?null:e.reduce((s,t)=>new Date(t.createdAt)>new Date(s.createdAt)?t:s,e[0])}function x(e){const s=e.reduce((t,r)=>{const n=new Date(r.createdAt).getFullYear();return t[n]||(t[n]=[]),t[n].push(r),t},{});return Object.entries(s).map(([t,r])=>({year:Number(t),requests:r}))}async function D(e){try{const s=await S({id:e}),t=x(s.data.data.requests),r=x(s.data.data.overtimes),n=x(s.data.data.leaveChangeLogs),i=t.map(p=>p.year.toString());w(t),k(r),N(n),b(i.length?i:[new Date().getFullYear().toString()]),f(i.length?i[0]:new Date().getFullYear().toString())}catch(s){console.log("Failed to get employee details",s)}}return d.useEffect(()=>{g&&D(g.id)},[g]),d.useEffect(()=>{var e,s;if(c&&h){const t=h.find(o=>o.year.toString()==c)??[],r=A.find(o=>o.year.toString()==c)??[],n=L.find(o=>o.year.toString()==c)??[];console.log(r),console.log(t);const i=t?(e=t==null?void 0:t.requests)==null?void 0:e.reduce((o,m)=>o+(m.isRequestApproved?m.leave??0:0),0):0,p=r?(s=r==null?void 0:r.requests)==null?void 0:s.reduce((o,m)=>o+(m.isRequestApproved?m.overtimeDays:0),0):0,u=C(n==null?void 0:n.requests);j({allottedLeaves:(u==null?void 0:u.newLeaves)??18,availableLeaves:((u==null?void 0:u.newLeaves)??18)-(i??0),consumedLeaves:i,overtime:p}),console.log(i,t)}},[c]),a.jsxs("div",{className:`flex flex-col gap-4 items-center p-6 ${v?"p-6 pt-0":"p-6"}`,children:[a.jsx("div",{className:"flex items-center gap-1 rounded-md p-1 bg-gray-200 dark:bg-white/20",children:y.map((e,s)=>a.jsxs("button",{onClick:()=>f(e),className:`py-2 px-3 rounded-md text-sm font-medium text-dark cursor-pointer ${c===e?"bg-primary text-white":"bg-white dark:bg-black dark:text-white"}`,children:["Year ",e]},s))}),a.jsx("div",{className:"grid grid-cols-12 gap-6 w-full",children:q.map(e=>a.jsx("div",{className:`${v?"lg:col-span-3":"lg:col-span-6"} col-span-12`,children:a.jsx(O,{children:a.jsxs($,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("h3",{className:"text-lg font-semibold text-dark",children:e.title}),a.jsx("p",{className:"text-sm text-muted",children:e.subtitle})]}),a.jsx("span",{className:`size-12 rounded-full ${e.color} flex items-center justify-center`,children:a.jsx(E,{icon:e.icon,width:28,height:28,className:"shrink-0"})})]}),a.jsx("div",{className:"flex flex-col items-start mt-2",children:a.jsx("h6",{className:"text-2xl text-dark dark:text-white font-semibold",children:e.value})})]})})},e.id))})]})}export{B as E};
