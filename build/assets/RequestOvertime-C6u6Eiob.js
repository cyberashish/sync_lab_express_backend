import{r as h,ae as k,ab as $,a as F,j as e,B as p,c as g,I as L,M as T}from"./index-snz9Drzv.js";import{u as R,L as x,c as E,a as P,d as I}from"./formik.esm-9zGVhWxH.js";import{C as M}from"./calendar-BB9x6ilc.js";import{D as B,b as A}from"./dialog-sE8zodbc.js";import{B as _}from"./index-BbEMVCca.js";import{P as V,a as W,C as H,b as J,s as Q}from"./employee_registration-DMtHMSpL.js";import{C as U}from"./card-B1be1i6x.js";import{T as z}from"./textarea-B50PAXxC.js";import{f as G}from"./format-SmSpYad1.js";import"./index-CdQ0CtSV.js";import"./isSymbol-qHNDJudD.js";const K=E().shape({overtimeDates:I().min(1,"Please pick at least one overtime date"),description:P().min(5,"Description should be at least 5 characters").required("Please enter work description")});function X(){const[j,c]=h.useState(!1),[y,{isLoading:D}]=k(),[b]=$(),o=F(t=>t.employee),{values:a,handleChange:f,handleSubmit:N,setFieldValue:d,errors:n,touched:m,handleBlur:v,resetForm:S,setFieldTouched:w}=R({initialValues:{overtimeDates:[],description:"",overtimeDays:0},validationSchema:K,onSubmit:async t=>{try{const s={employeeId:o.employeeId,name:o.name,email:o.email,designation:o.designation,description:t.description,overtimeDays:t.overtimeDays,overtimeDates:t.overtimeDates.map(l=>({date:l.date.toISOString(),duration:l.duration}))},r=await y(s);let i="";if(t.overtimeDates.length>1){const l=new Date(t.overtimeDates[0].date).toLocaleDateString(),C=new Date(t.overtimeDates[t.overtimeDates.length-1].date).toLocaleDateString();i=`${o.name} has requested overtime from ${l} to ${C}.`}else{const l=new Date(t.overtimeDates[0].date).toLocaleDateString();i=`${o.name} has requested overtime for ${l}`}const u=await b({title:"New overtime request",message:i,type:"OVERTIME_REQUEST"});O(),r.error||u.error?alert("Overtime request submission failed!"):(c(!0),S())}catch(s){console.error(s),alert("Something went wrong!")}}}),q=t=>{const s=t.map(r=>({date:r,duration:"Full Day"}));d("overtimeDates",s)};h.useEffect(()=>{if(a.overtimeDates){let t=0;const s=a.overtimeDates[0];if(a.overtimeDates.forEach(r=>{r.duration==="Half Day"?t=t+.5:t=t+1}),d("overtimeDays",t),a.overtimeDates.length===1){const r=new Date(s.date).getDate(),i=new Date().getDate();r===i-1&&d("leaveType","Sick")}}},[a]);async function O(){try{let t="";if(a.overtimeDates.length>1){const i=new Date(a.overtimeDates[0].date).toLocaleDateString(),u=new Date(a.overtimeDates[a.overtimeDates.length-1].date).toLocaleDateString();t=`${o.name} has requested overtime from ${i} to ${u}.`}else{const i=new Date(a.overtimeDates[0].date).toLocaleDateString();t=`${o.name} has requested overtime for ${i}.`}const s=await fetch("https://formsubmit.co/ajax/cybermadhav0@gmail.com",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:o.name,message:t,_subject:"Overtime request from Wrappixel EMS",_cc:"cyberashish321@gmail.com,niravjoshi87@gmail.com",_template:"table"})}),r=await s.json();s.ok?console.log("âœ… Overtime request sent successfully:",r):console.error("âŒ Failed to send overtime request:",r)}catch(t){console.error("ðŸš¨ Error sending overtime request:",t)}}return e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"py-6 px-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark border-b border-border pb-3 mb-4 px-6",children:"Overtime Request Form"}),e.jsxs("form",{onSubmit:N,className:"grid grid-cols-12 gap-6 px-6",children:[e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-8 col-span-12",children:[e.jsx(x,{className:"text-sm font-medium text-dark",children:"Select Dates"}),e.jsxs(V,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(p,{variant:"outline",onBlur:()=>w("overtimeDates",!0),className:g("w-full justify-start text-left font-normal",a.overtimeDates.length===0&&"text-muted-foreground",n.overtimeDates&&m.overtimeDates?"border-error":""),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),a.overtimeDates.length>0?a.overtimeDates.map(t=>G(t.date,"do MMM")).join(", "):"Pick dates"]})}),e.jsx(J,{className:"w-auto p-0 border-border",align:"start",children:e.jsx(M,{mode:"multiple",selected:a.overtimeDates.map(t=>t.date),onSelect:t=>q(t||[]),initialFocus:!0})})]}),typeof n.overtimeDates=="string"&&m.overtimeDates&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:n.overtimeDates})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-4 col-span-12",children:[e.jsx(x,{className:"text-sm font-medium text-dark",children:"Overtime Days"}),e.jsx(L,{type:"number",id:"overtime_count",value:a.overtimeDays,onChange:f,name:"overtimeDays",onBlur:v,className:`${n.overtimeDays&&m.overtimeDays?"border-red-500 focus:!border-red-500":null}`,placeholder:"Taken Leaves"}),m.overtimeDays&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:n.overtimeDays})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 col-span-12",children:[e.jsx(x,{className:"text-sm font-medium text-dark",children:"Work Description"}),e.jsx(z,{name:"description",value:a.description,onChange:f,onBlur:v,className:g(n.description&&m.description?"border-red-500":""),placeholder:"Please describe your work..."}),n.description&&m.description&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:n.description})]}),e.jsx("div",{className:"col-span-12 flex justify-center",children:e.jsx(p,{type:"submit",disabled:D,className:"lg:w-2/12 w-full",children:D?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(T,{className:"animate-spin"}),"Submitting..."]}):"Submit Request"})})]})]}),e.jsx(B,{open:j,onOpenChange:t=>c(t),children:e.jsxs(A,{className:"sm:max-w-[350px]",children:[e.jsx(_,{className:"hidden"}),e.jsxs("div",{children:[e.jsx("img",{src:Q,alt:"success",className:"w-full"}),e.jsx("h2",{className:"text-lg font-semibold text-primary text-center",children:"Overtime Request Submitted Successfully!"})]}),e.jsx(p,{className:"w-fit mx-auto",onClick:()=>c(!1),children:"Close"})]})})]})}function Y(){return e.jsx(X,{})}function ce(){return e.jsx(e.Fragment,{children:e.jsx(Y,{})})}export{ce as default};
