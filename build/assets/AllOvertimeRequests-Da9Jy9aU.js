import{a as g,$ as q,u as C,a2 as k,j as e,B as b,M as F,Z as y,W as I,x as Y,a3 as H,a4 as _,Y as f,a5 as S,_ as P,r as j,q as Q,I as G}from"./index-snz9Drzv.js";import{C as W}from"./card-B1be1i6x.js";import{u as $,k as Z,g as z,h as J,i as X,T as ee,a as se,b as A,c as ae,f as E,d as te,e as re}from"./TableSkeleton-BcOXqcpn.js";import{D as L,b as V,c as K,d as B}from"./dialog-sE8zodbc.js";import{I as m}from"./iconify-C_4D0c8V.js";import{T as R,a as T,b as M,c as O}from"./tooltip-CGbfAgdI.js";import{f as oe}from"./format-SmSpYad1.js";import"./index-BbEMVCca.js";import"./index-CdQ0CtSV.js";import"./index-Fiz7wX8i.js";function ie(){const a=g(n=>n.requestStatus.isDisapproveDialogOpen),s=g(n=>n.requestStatus.selectedOvertimeRequest),[i]=q(),l=C(),[c,{isLoading:d}]=k(),h=async()=>{await c({id:s==null?void 0:s.id,requestStatus:"Disapproved",isRequestApproved:!1}),l(y(!1)),await i({email:s==null?void 0:s.email,title:"Overtime Disapproved",message:"Your overtime request has been disapproved!",type:"OVERTIME_REQUEST"})};return e.jsx(L,{open:a,onOpenChange:n=>l(y(n)),children:e.jsxs(V,{className:"sm:max-w-sm",children:[e.jsx(K,{children:e.jsx(B,{children:"Are you absolutely sure?"})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(b,{disabled:d,variant:"destructive",onClick:h,className:"flex items-center gap-2",children:[d?e.jsx(F,{className:"animate-spin"}):null,"DisApprove"]}),e.jsx(b,{onClick:()=>l(y(!1)),children:"Cancel"})]})]})})}function le(){const a=g(o=>o.requestStatus.isApproveDialogOpen),s=g(o=>o.requestStatus.selectedOvertimeRequest),[i,{isLoading:l}]=k(),[c]=q(),[d]=I(),[h]=Y(),[n]=H(),x=C(),[w]=_();async function D(o,v){try{const u=(await h({email:o})).data.data;await n({employeeId:u.id,newLeaves:u.allottedLeaves+parseFloat(v)}),await d({id:u.id,allottedLeaves:u.allottedLeaves+parseFloat(v)})}catch(p){console.log(p,"Failed to update overtime"),alert("Failed to update overtime!")}}const N=async()=>{await i({id:s.id,requestStatus:"Approved",isRequestApproved:!0}),await w({email:s==null?void 0:s.email,overtime:s==null?void 0:s.overtimeDays}),D(s==null?void 0:s.email,s==null?void 0:s.overtimeDays),x(f(!1)),await c({email:s==null?void 0:s.email,title:"Overtime Approved",message:"Your overtime has been approved!",type:"OVERTIME_REQUEST"})};return e.jsx(L,{open:a,onOpenChange:o=>x(f(o)),children:e.jsxs(V,{className:"sm:max-w-sm",children:[e.jsx(K,{children:e.jsx(B,{children:"Are you absolutely sure?"})}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs(b,{onClick:N,disabled:l,className:"flex items-center gap-2",children:[l?e.jsx(F,{className:"animate-spin"}):null,"Approve"]}),e.jsx(b,{variant:"destructive",onClick:()=>x(f(!1)),children:"Cancel"})]})]})})}const ne=a=>{const s=C();return e.jsx("div",{className:"flex items-center gap-3",children:a.requestStatus==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs(T,{children:[e.jsx(M,{asChild:!0,children:e.jsx("button",{onClick:()=>{s(S(a)),s(f(!0))},children:e.jsx(m,{icon:"solar:check-circle-bold",width:24,height:24,className:"text-success hover:text-success/90 cursor-pointer"})})}),e.jsx(O,{children:e.jsx("p",{children:"Approve request"})})]})}),e.jsx(R,{children:e.jsxs(T,{children:[e.jsx(M,{asChild:!0,children:e.jsx("button",{onClick:()=>{s(S(a)),s(y(!0))},children:e.jsx(m,{icon:"solar:close-circle-bold",width:24,height:24,className:"text-red-500 hover:text-red-400 cursor-pointer"})})}),e.jsx(O,{className:"bg-red-500 fill-red-500",children:e.jsx("p",{children:"Disapprove Request"})})]})})]}):a.isRequestApproved?e.jsx(m,{icon:"solar:verified-check-bold",width:24,height:24,className:"text-success hover:text-success/90 cursor-pointer"}):e.jsx(m,{icon:"icon-park-twotone:close-one",width:24,height:24,className:"text-red-500 hover:text-red-500/20 cursor-pointer"})})},ce=[{accessorKey:"employeeId",header:"Id",cell:({row:a})=>e.jsx("p",{className:"text-primary",children:a.getValue("employeeId")})},{accessorKey:"name",header:"Name"},{accessorKey:"designation",header:"Designation"},{accessorKey:"description",header:"Work"},{accessorKey:"date",header:({column:a})=>e.jsxs("button",{onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"flex cursor-pointer group hover:text-primary items-center gap-2",children:[e.jsx("span",{children:"Applied Date"}),e.jsx(m,{icon:"mi:sort",width:20,height:20,className:"text-muted group-hover:text-primary"})]}),cell:({row:a})=>e.jsx("p",{children:P(a.getValue("date"))}),sortingFn:(a,s)=>{const i=new Date(a.getValue("date")),l=new Date(s.getValue("date"));return i.getTime()-l.getTime()}},{accessorKey:"overtimeDates",header:()=>e.jsx("button",{className:"flex cursor-pointer group hover:text-primary items-center gap-2",children:e.jsx("span",{children:"Overtime Dates"})}),cell:({row:a})=>{const s=a.getValue("overtimeDates");return e.jsxs("p",{className:"text-sm",children:[" ",s.map(i=>oe(new Date(i.date),"do MMM")).join(", ")]})}},{accessorKey:"overtimeDays",header:"Days"},{accessorKey:"requestStatus",header:"Status",cell:({row:a})=>{const s=a.getValue("requestStatus"),i=a.original.isRequestApproved;return s!=="pending"?i?e.jsx("span",{className:"py-0.5 px-2 text-xs bg-success/20 text-success rounded-full",children:"Approved"}):e.jsx("span",{className:"py-0.5 px-2 text-xs bg-red-500/20 text-red-500 rounded-full",children:"Rejected"}):e.jsx("span",{className:"py-0.5 px-2 text-xs bg-yellow-500/20 text-yellow-500 rounded-full",children:"Pending"})}},{id:"Approval",header:"Approval Actions",cell:({row:a})=>{const s=a.original;return ne(s)}}],de={isSearchFocussed:!1,searchInput:""};function pe(){const a="SEARCH_INPUT",s="SEARCH_INPUT_FOCUSSED",i=(r,t)=>{switch(t.type){case a:return{...r,searchInput:t.payload};case s:return{...r,isSearchFocussed:t.payload};default:return r}},[l,c]=j.useReducer(i,de),[d,h]=j.useState([]),{data:n,isLoading:x}=Q(void 0),w=()=>{c({type:s,payload:!0})},D=()=>{c({type:s,payload:!1})},N=j.useMemo(()=>[...d],[d]);j.useEffect(()=>{n&&h(n.data)},[n]);const o=$({data:N,columns:ce,getCoreRowModel:J(),getFilteredRowModel:z(),getSortedRowModel:Z()}),v=r=>{var t;c({type:a,payload:r.target.value}),(t=o.getColumn("name"))==null||t.setFilterValue(r.target.value)},p=g(r=>r.employee),[u]=I();async function U(){await u({email:p.email,totalLeaves:p.totalLeaves,casualLeaves:p.casualLeaves})}return e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"p-0",children:[e.jsxs("div",{className:"p-6 border-b border-border flex items-center lg:flex-nowrap gap-2 flex-wrap justify-between",children:[e.jsx("h5",{onClick:U,className:"text-lg font-semibold leading-none text-dark",children:"Overtime Request Status"}),e.jsxs("div",{className:`flex items-center border rounded-md px-3 flex-1 max-w-80 ${l.isSearchFocussed?"border-primary ":"border-border"}`,children:[e.jsx(m,{icon:"si:search-line",width:20,height:20,className:"shrink-0 text-dark"}),e.jsx(G,{onBlur:D,onFocus:w,onChange:v,value:l.searchInput,type:"search",id:"email",name:"email",placeholder:"Search by name...",className:"max-w-80 h-9 bg-transparent dark:bg-transparent dark:text-white shadow-none border-none px-2"})]})]}),e.jsx("div",{className:"p-6 pt-0",children:e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:x?e.jsx(X,{}):e.jsxs(ee,{className:"font-medium",children:[e.jsx(se,{children:o.getHeaderGroups().map(r=>e.jsx(A,{children:r.headers.map(t=>e.jsx(ae,{className:"first:px-4",children:t.isPlaceholder?null:E(t.column.columnDef.header,t.getContext())},t.id))},r.id))}),e.jsx(te,{children:o.getRowModel().rows.length?o.getRowModel().rows.map(r=>e.jsx(A,{children:r.getVisibleCells().map(t=>e.jsx(re,{className:"first:px-4",children:E(t.column.columnDef.cell,t.getContext())},t.id))},r.id)):null})]})})})]}),e.jsx(ie,{}),e.jsx(le,{})]})}const we=()=>e.jsx(e.Fragment,{children:e.jsx(pe,{})});export{we as default};
