import{r as h,aa as V,ab as O,a as _,ac as H,j as e,c as f,B as p,I as J,M as Q}from"./index-snz9Drzv.js";import{u as U,L as m,c as W,a as S,d as z}from"./formik.esm-9zGVhWxH.js";import{C as G}from"./calendar-BB9x6ilc.js";import{D as K,b as X}from"./dialog-sE8zodbc.js";import{B as Y}from"./index-BbEMVCca.js";import{P as Z,a as ee,C as ae,b as te,s as se}from"./employee_registration-DMtHMSpL.js";import{C as le}from"./card-B1be1i6x.js";import{S as N,a as C,b as L,c as T,e as u}from"./select-Dq2TSXwE.js";import{T as ne}from"./textarea-B50PAXxC.js";import{f as w}from"./format-SmSpYad1.js";import"./index-CdQ0CtSV.js";import"./isSymbol-qHNDJudD.js";import"./index-CkXKLtb8.js";import"./index-Fiz7wX8i.js";const re=W().shape({leaveType:S().required("Please select a leave type"),leaveDates:z().min(1,"Please pick at least one leave date"),description:S().min(5,"Description should be at least 5 characters").required("Please enter a reason")});function oe(){const[q,v]=h.useState(!1),[k,{isLoading:D}]=V(),[E]=O(),o=_(a=>a.employee),[$,g]=h.useState(!1),{values:t,handleChange:j,handleSubmit:F,setFieldValue:d,errors:l,touched:i,handleBlur:y,resetForm:R,setFieldTouched:b}=U({initialValues:{leaveType:"",leaveDates:[],description:"",leaveCount:0},validationSchema:re,onSubmit:async a=>{try{const n={employeeId:o.employeeId,name:o.name,email:o.email,designation:o.designation,description:a.description,leave:a.leaveCount,leaveType:a.leaveType,leaveDates:a.leaveDates.map(c=>({date:c.date.toISOString(),duration:c.duration}))},r=await k(n);let s="";if(a.leaveDates.length>1){const c=new Date(a.leaveDates[0].date).toLocaleDateString(),B=new Date(a.leaveDates[a.leaveDates.length-1].date).toLocaleDateString();s=`${o.name} has requested leave from ${c} to ${B}.`}else{const c=new Date(a.leaveDates[0].date).toLocaleDateString();s=`${o.name} has requested leave for ${c}`}const x=await E({title:"New leave request",message:s,type:"LEAVE_REQUEST"});I(),r.error||x.error?alert("Leave request submission failed!"):(v(!0),R())}catch(n){console.error(n),alert("Something went wrong!")}}}),M=a=>{const n=a.map(r=>({date:r,duration:"Full Day"}));d("leaveDates",n)};h.useEffect(()=>{if(t.leaveDates){let a=0;const n=t.leaveDates[0];if(t.leaveDates.forEach(r=>{r.duration==="Half Day"?a=a+.5:a=a+1}),d("leaveCount",a),t.leaveDates.length===1){const r=new Date(n.date).getDate(),s=new Date().getDate();r===s-1&&(d("leaveType","Sick"),g(!0))}else g(!1)}},[t]);async function I(){try{let a="";if(t.leaveDates.length>1){const s=new Date(t.leaveDates[0].date).toLocaleDateString(),x=new Date(t.leaveDates[t.leaveDates.length-1].date).toLocaleDateString();a=`${o.name} has requested leave from ${s} to ${x}.`}else{const s=new Date(t.leaveDates[0].date).toLocaleDateString();a=`${o.name} has requested leave for ${s}.`}const r=await(await fetch("https://formsubmit.co/ajax/cybermadhav0@gmail.com",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:o.name,message:a,_subject:"Leave request from Wrappixel EMS",_cc:"cyberashish321@gmail.com,niravjoshi87@gmail.com",_template:"table"})})).json();console.log("Success:",r)}catch(a){console.error("Error:",a)}}const[P]=H();async function A(){await P({name:"Ashish",message:"I am requesting for 2 days leave",_subject:"Leave Request"})}return e.jsxs(e.Fragment,{children:[e.jsxs(le,{className:"py-6 px-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark border-b border-border pb-3 mb-4 px-6",children:"Leave Request Form"}),e.jsxs("form",{onSubmit:F,className:"grid grid-cols-12 gap-6 px-6",children:[e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-4 col-span-12",children:[e.jsx(m,{className:"text-sm font-medium text-dark",children:"Leave Type"}),e.jsxs(N,{name:"leaveType",disabled:$,value:t.leaveType,onValueChange:a=>d("leaveType",a),children:[e.jsx(C,{onBlur:()=>b("leaveType",!0),className:f(l.leaveType&&i.leaveType?"border-error":""),children:e.jsx(L,{placeholder:"Select leave type"})}),e.jsxs(T,{children:[e.jsx(u,{value:"Casual",children:"Casual Leave"}),e.jsx(u,{value:"Sick",children:"Sick Leave"}),e.jsx(u,{value:"Vacation",children:"Vacation Leave"})]})]}),l.leaveType&&i.leaveType&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:l.leaveType})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-6 col-span-12",children:[e.jsx(m,{className:"text-sm font-medium text-dark",children:"Select Dates"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(p,{variant:"outline",onBlur:()=>b("leaveDates",!0),className:f("w-full justify-start text-left font-normal",t.leaveDates.length===0&&"text-muted-foreground",l.leaveDates&&i.leaveDates?"border-error":""),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),t.leaveDates.length>0?t.leaveDates.map(a=>w(a.date,"do MMM")).join(", "):"Pick dates"]})}),e.jsx(te,{className:"w-auto p-0 border-border",align:"start",children:e.jsx(G,{mode:"multiple",selected:t.leaveDates.map(a=>a.date),onSelect:a=>M(a||[]),initialFocus:!0})})]}),typeof l.leaveDates=="string"&&i.leaveDates&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:l.leaveDates})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-2 col-span-12",children:[e.jsx(m,{className:"text-sm font-medium text-dark",children:"Leaves Count"}),e.jsx(J,{type:"number",id:"leave_count",value:t.leaveCount,onChange:j,name:"leaveCount",onBlur:y,className:`${l.leaveCount&&i.leaveCount?"border-red-500 focus:!border-red-500":null}`,placeholder:"Taken Leaves"}),i.leaveCount&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:l.leaveCount})]}),t.leaveDates.map((a,n)=>e.jsxs("div",{className:"flex flex-col gap-1.5 lg:col-span-2 col-span-12",children:[e.jsx(m,{className:"text-sm font-medium text-dark",children:w(a.date,"do MMM")}),e.jsxs(N,{value:a.duration,onValueChange:r=>{const s=[...t.leaveDates];s[n].duration=r,d("leaveDates",s)},children:[e.jsx(C,{children:e.jsx(L,{})}),e.jsxs(T,{children:[e.jsx(u,{value:"Full Day",children:"Full Day"}),e.jsx(u,{value:"Half Day",children:"Half Day"})]})]})]},n)),e.jsxs("div",{className:"flex flex-col gap-1.5 col-span-12",children:[e.jsx(m,{className:"text-sm font-medium text-dark",children:"Reason / Description"}),e.jsx(ne,{name:"description",value:t.description,onChange:j,onBlur:y,className:f(l.description&&i.description?"border-red-500":""),placeholder:"Explain your reason for leave..."}),l.description&&i.description&&e.jsx("p",{className:"text-sm text-red-500 font-medium",children:l.description})]}),e.jsx("div",{className:"col-span-12 flex justify-center",children:e.jsx(p,{type:"submit",disabled:D,className:"lg:w-2/12 w-full",children:D?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Q,{className:"animate-spin"}),"Submitting..."]}):"Submit Request"})})]})]}),e.jsx(p,{onClick:A,children:"Test Email"}),e.jsx(K,{open:q,onOpenChange:a=>v(a),children:e.jsxs(X,{className:"sm:max-w-[350px]",children:[e.jsx(Y,{className:"hidden"}),e.jsxs("div",{children:[e.jsx("img",{src:se,alt:"success",className:"w-full"}),e.jsx("h2",{className:"text-lg font-semibold text-primary text-center",children:"Leave Request Submitted Successfully!"})]}),e.jsx(p,{className:"w-fit mx-auto",onClick:()=>v(!1),children:"Close"})]})})]})}function ie(){return e.jsx(oe,{})}function Se(){return e.jsx(e.Fragment,{children:e.jsx(ie,{})})}export{Se as default};
